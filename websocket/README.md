# Запуск приложения с WebSocket

## Ограничения
- Веб-сокеты могут подключаться только по порту (порт 8081)
- На данный момент доступно только незащищенное соединение ws
- Не работают через сервис nip.io, только через .localhost
- Для сервера веб-сокетов требуется отдельный контейнер

> Минимально допустимая версия DL 0.5.7  
> После обновления перезапустите локальные сервисы командой `dl service recreate` 

## Настройка
### Добавление docker-compose файла

Сервер веб-сокетов должен быть расположен в отдельном docker-контейнере, даже если в качестве сервера выступает текущее PHP-приложение.

Копируем docker-compose файл из [примера](.docker/docker-compose-ws.yaml), в котором нужно заменить необходимые вам параметры.

Если в качестве сервера используется проект PHP с отдельной консольной командой, то нужно добавить в `volumes` текущую директорию проекта, также можно в `entrypoint` прописать команду запуска скрипта (чтобы при старте проекта сервер запускался автоматически). Иначе в контейнер нужно прокинуть, например, другую директорию, если сервер веб-сокетов реализован отдельно или на другом стеке (go, nodejs и тд).

Указанные в примере labels обязательны, по ним Traefik определяет, что текущий контейнер нужно пропустить через прокси. В нашем случае это порт ws 8081.

Контейнер должен находиться в той же подсети, что и основной проект.

После настройки запуска контейнера, нужно подключить созданный файл в dl через параметр `APPEND_COMPOSE_FILE` в .env файле.

```dotenv
APPEND_COMPOSE_FILE=.docker/docker-compose-ws.yaml
```

И запустить проект.

![websocket.png](..%2Fimage%2Fwebsocket.png)
